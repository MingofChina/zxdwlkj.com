{extend name="layout/layout3" /}

{block name="css"}
    <link type="text/css" rel="stylesheet" href="/public/times/1.css">
    
{/block}

{block name="content"}
<div class="layui-body">
    <!--tab标签-->
    <div class="layui-tab layui-tab-brief">
        <ul class="layui-tab-title">
            <li class="">修改活动</li>
            <!-- <li class="layui-this">添加文章</li> -->
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <form id="good" class="layui-form form-container" action="{:url('active/zuoupdateactive')}" method="post">
                    <input type="hidden" name="id" value="{$data.id}">
                    <div class="layui-form-item">
                        <label class="layui-form-label">所属地点</label>
                        <div class="layui-input-block">
                            <select name="place_cate" lay-verify="required">
                                
                                {foreach name="places" item="vo"}
                                <option value="{$vo.name}" {if condition="($vo.name eq $data.name)"} selected {/if}>{$vo.name}</option>
                                {/foreach}
                                
                               
                            </select>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">活动标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" value="{$data.title}" required  lay-verify="required" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">banner图</label>
                        <div class="layui-input-block">
                            <input type="hidden" id="pic" name="banner" value="{$data.banner}">
                            <input type="file" onchange="picUpload()" name="slt" >
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">banner图展示</label>
                        <div class="layui-input-block" >
                            <img src="{$data.banner}" id="slideimg">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">预约开始时间</label>
                        <div class="layui-input-block">
                            <!-- <input name="start_time" value="{$shijian}" class="laydate-icon" onClick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})"> -->
                            <input type="text" id="date2" name="start_time" value="{$data.start_time}">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">预约结束时间</label>
                        <div class="layui-input-block">
                            <input type="text" id="date3" name="end_time" value="{$data.end_time}">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">活动地点</label>
                        <div class="layui-input-block">
                            <input type="text" name="place" value="{$data.place}" required  lay-verify="required"  class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">活动说明</label>
                        <div class="layui-input-block">
                            <input type="text" name="descrip" value="{$data.descrip}" required  lay-verify="required" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">详情图片组</label>
                        <div class="layui-input-block">
                            <input type="hidden" id="detail_pics" name="detail_pics" value="{$data.detail_pics}">
                            <input type="file" onchange="erpicUpload()" name="detail_img" >
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">详情图片组展示</label>
                        <div class="layui-input-block">
                            <div id="charu">
                                <!-- <div style="float:left;margin-top:20px;">
                                    <a href="/public/uploads/20200620/6abac3dacda262280ce5da5db9331fb5.png" target="_blank">
                                        <img src="/public/uploads/20200620/6abac3dacda262280ce5da5db9331fb5.png" class="imgss" style="width:100px;height:100px;">
                                    </a>
                                    <img src="/public/file/images/cuo.png" style="width:20px;height:20px;position: relative;left:-16px;top:-46px;">
                                </div> -->


                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">课程日期</label>
                        <div class="layui-input-block">
                            <input type="text" name="start_day" value="{$data.start_day}" required  lay-verify="required" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">课程时间</label>
                        <div class="layui-input-block">
                            <input type="text" name="lesson_time" value="{$data.lesson_time}" required  lay-verify="required" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">课程功能</label>
                        <div class="layui-input-block">
                            <input type="text" name="lesson_function" value="{$data.lesson_function}" required  lay-verify="required" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">教练名字</label>
                        <div class="layui-input-block">
                            <input type="text" name="lesson_coach" value="{$data.lesson_coach}" required  lay-verify="required"  class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">从课程中获得</label>
                        <div class="layui-input-block">
                            <input type="text" name="lesson_learned" value="{$data.lesson_learned}" required  lay-verify="required"  class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">跟着课程一起</label>
                        <div class="layui-input-block">
                            <input type="text" name="lesson_together" value="{$data.lesson_together}" required  lay-verify="required"  class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">启发我个人灵感的有</label>
                        <div class="layui-input-block">
                            <input type="text" name="personal_inspiration" value="{$data.personal_inspiration}" required  lay-verify="required"  class="layui-input">
                        </div>
                    </div>



                    
                   
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="*">保存</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="js"}
    <script type="text/javascript">
        //给表单元素绑定change事件
        function picUpload(){
            $.ajax({
                url:"{:url('slideimg/picUpload')}",
                type:'POST',
                cache:false,
                data:new FormData($('#good')[0]),
                processData:false,
                contentType:false,
                dataType:"text",
                success:function(data){
                    console.log(data);
                    $('#pic').attr('value',data);
                    $('#slideimg').attr('src',data);
                    $('#slideimg').parent().css('display','block');
                },
                error:function(data){
                    console.log(data);
                    // $('#pic').attr('value',data);
                },
                async:false
            });
        }
    </script>

    <script type="text/javascript" charset="utf-8" src="/public/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/public/ueditor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="/public/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script>
        //实例化编辑器
        //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
          var ue = UE.getEditor('editor', {
    toolbars: [
            ['source', 'bold', 'italic', 'underline', 'strikethrough', 'blockquote', 'insertunorderedlist', 'insertorderedlist', 'justifyleft','justifycenter', 'justifyright',  'link', 'insertimage', 'fullscreen']
        ],
        elementPathEnabled: false,
        enableContextMenu: false,
        autoClearEmptyNode:true,
        wordCount:false,
        imagePopup:false,
        autotypeset:{ indent: true,imageBlockLine: 'center' }
    });

          


    </script>

    <!-- <script type="text/javascript" src="/public/timejs/laydate.js"></script>
    <script type="text/javascript">
        !function(){
            laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
            laydate({elem: '#demo'});//绑定元素
        }();
    </script> -->

    <script type="text/javascript" src="/public/times/1.js"></script>
    <script type="text/javascript">
        // demo1
        // var picker1 = new Datepicker({
        //     elemName: 'date1',
        //     format: 'YYYY-MM-DD hh:mm:ss',
        //     min: -4,
        //     callBack: function(a, b){
        //         console.log(a, b)
        //     }
        // });

        // demo2
        var picker2 = new Datepicker({
            elemName: 'date2',
            format: 'YYYY-MM-DD hh:mm:ss',
            callBack: function(a, b){
                picker3.setMinScope(b, 1);
            }
        });
        var picker3 = new Datepicker({
            elemName: 'date3',
            format: 'YYYY-MM-DD hh:mm:ss',
            callBack: function(a, b){
                picker2.setMaxScope(a);
            }
        });
    </script>

    <script type="text/javascript">
        function erpicUpload(){

            $.ajax({
                url:"{:url('active/erpicUpload')}",
                type:'POST',
                cache:false,
                data:new FormData($('#good')[0]),
                processData:false,
                contentType:false,
                dataType:"text",
                success:function(data){
                    console.log(data);
                    var str = '';
                   

                    str += `
                        <div style="float:left;margin-top:20px;">
                            <a href="${data}" target="_blank">
                                <img src="${data}" class="imgss" style="width:100px;height:100px;">
                            </a>
                            <img src="/public/file/images/cuo.png" class="sss" style="width:20px;height:20px;position: relative;left:-16px;top:-46px;">
                        </div>
                    `;
                    
                    $('#charu').append(str);
                    shanchu();

                    chongzhi();
                },
                error:function(data){
                    console.log(123);
                    console.log(data);
                }
            });
        }

        function shanchu(){
            $('.sss').click(function(){
                $(this).parent().remove();
                chongzhi();
            })
        }

        function chongzhi(){
            var pinjie = '';
            $('.imgss').each(function(){
                pinjie += $(this).attr('src') + ',';
            });
            // console.log(pinjie);
            $('#detail_pics').val(pinjie);
        }

        var picers = $('#detail_pics').val().split(',');

        $.each(picers,function(index,value){
            // console.log(index);
            // console.log(value);
            if(value){
                var str = '';
                    str += `
                        <div style="float:left;margin-top:20px;">
                            <a href="${value}" target="_blank">
                                <img src="${value}" class="imgss" style="width:100px;height:100px;">
                            </a>
                            <img src="/public/file/images/cuo.png" class="sss" style="width:20px;height:20px;position: relative;left:-16px;top:-46px;">
                        </div>
                    `;
                    
                    $('#charu').append(str);
                    shanchu();

                    chongzhi();
            }
        });
    </script>
{/block}
